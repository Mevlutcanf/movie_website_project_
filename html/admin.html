<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionBox</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="shortcut icon" type="image/png" href="../icon.png">
    <script src="../js/index.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
    <!-- Font preloading ekleyelim -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/admin.css">
    <!-- YouTube iframe API'sini ekleyelim -->
    <script async src="https://www.youtube.com/iframe_api"></script>
</head>

<body>
    <!-- HEADER -->
    <header>
        <h1 style="cursor: pointer;" onclick="handleLogoClick()">VisionBox</h1> <!-- 'index.html' yerine 'user.html' yapıldı -->
        <form id="form">
            <input type="text" class="search" id="search" placeholder="İstediğiniz filmleri arayın" autocomplete="off">
        </form>
        <nav>
            <span id="user-email" style="margin-right: 10px; color: white;">👋 Hoşgeldiniz</span>
            <a href="guest.html" style="margin-right: 10px;" id="logout-btn" onclick="handleLogout(event)">Çıkış Yap</a>
        </nav>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="main-container">
        <!-- Sol Taraf: Tür Seçici -->
        <aside class="genre-selector">
            <style>
            .genre-title {
                font-family: 'Poppins', sans-serif;
                color: #000000;
                font-size: 24px;
                margin-bottom: 10px;
            }
            #genre-list li {
                font-size: 18px; /* Yazıların boyutunu büyütmek için */
            }
            </style>
            <div style="background-color: #666363; padding: 10px; border-radius: 5px; display: inline-block;">
                <h1 class="genre-title">🎬 Türler</h1>
            </div>
            <!-- Türler Listesi -->
            <ul id="genre-list">
            <!-- Türler API'den dinamik olarak yüklenecek -->
            </ul>
        </aside>

        <!-- Orta Kısım: Ana Filmler -->
        <section class="movies">
            
            <div id="main" class="movie-grid">
                <!-- Filmler burada yüklenecek -->
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button id="prev-page">Önceki Sayfa</button>
                <span id="current-page">Sayfa: 1</span>
                <button id="next-page">Sonraki Sayfa</button>
            </div>
        </section>

        <!-- Sağ Taraf: Önerilen Filmler -->
        <aside id="recommended-movies" class="recommended-movies">
            <h2 style="font-family: 'Poppins', sans-serif; color: #000000; font-size: 24px; margin-bottom: 10px; background-color: #666363; padding: 10px; border-radius: 5px; display: inline-block;">🍿 Önerilen Filmler</h2>
            <div id="recommended-list">
                <!-- Burada önerilen filmler gösterilecek -->
            </div>
        </aside>
    </div>

    <!-- FOOTER -->
    <footer>
        <h3>VisionBox</h3>
        <ul>
            <li><a href="#">Koşullar ve Gizlilik</a></li>
            <li><a href="#">Geri Bildirimde Bulunun</a></li>
            <li><a href="#">Çerez Politikası</a></li>
            <li><a href="#">Yardım</a></li>
        </ul>
        <small>© 2024 Haklarınız Saklıdır.</small>
        <small>© 2024 BU SİTE PROJE AMAÇLI MEVLÜT FINDIK TARAFINDAN YAPILMIŞTIR.</small>
    </footer>

    <!-- DARK MODE TOGGLE -->
    
    <script>
        // Font yükleme optimizasyonu
        if ('fonts' in document) {
            Promise.all([
                document.fonts.load('1em Poppins'),
                document.fonts.load('500 1em Poppins'),
                document.fonts.load('600 1em Poppins')
            ]).then(() => {
                document.documentElement.classList.add('fonts-loaded');
            });
        }

        // Kullanıcı e-postasını localStorage'dan al ve göster
        document.addEventListener('DOMContentLoaded', () => {
            const userEmail = localStorage.getItem('userEmail');
            const userEmailElement = document.getElementById('user-email');
            
            if (userEmail && userEmailElement) {
                userEmailElement.textContent = `👋 Hoşgeldin, ${userEmail.split('@')[0]}`; // Sadece @ işaretinden önceki kısmı göster
            }
            
            // Çıkış yap butonuna tıklandığında
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
        });

        // Dark mode ayarları
        const options = {
            bottom: '64px',
            right: '32px',
            time: '0.5s',
            mixColor: '#c9d6ff',
            backgroundColor: '#333',
            buttonColorDark: '#100f2c',
            buttonColorLight: '#fff',
            saveInCookies: true,
            label: '🌓',
            autoMatchOsTheme: false
        };
        
        const darkmode = new Darkmode(options);
        darkmode.showWidget();

        // Çıkış yapma işlemi için yeni fonksiyon
        function handleLogout(event) {
            event.preventDefault();
            const confirmLogout = confirm('Çıkış yapmak istediğinize emin misiniz?');
            if (confirmLogout) {
                localStorage.removeItem('userEmail');
                window.location.href = 'index.html';
            }
        }

        // Kullanıcı durumu kontrolü
        document.addEventListener('DOMContentLoaded', () => {
            const userEmail = localStorage.getItem('userEmail');
            if (!userEmail) {
                // Eğer kullanıcı girişi yoksa login sayfasına yönlendir
                window.location.href = 'login.html';
            } else {
                const userEmailElement = document.getElementById('user-email');
                if (userEmailElement) {
                    userEmailElement.textContent = `👋 Hoşgeldin, ${userEmail.split('@')[0]}`;
                }
            }
        });

        // Logo tıklama işleyicisi
        function handleLogoClick() {
            const userEmail = localStorage.getItem('userEmail');
            if (userEmail) {
                window.location.href = 'user.html';
            } else {
                window.location.href = 'index.html';
            }
        }
    </script>
</body>

</html>
